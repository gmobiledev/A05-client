<div class="card mt-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="card-title mb-0 font-weight-bold">Danh s√°ch s·ªë ƒë√£ s·ª≠ d·ª•ng</h4>
    </div>

    <form (ngSubmit)="onSubmitSearch()" class="row">
      <div class="col-md-4 mb-2">
        <input class="form-control" [(ngModel)]="searchForm.search" name="search" placeholder="Nh·∫≠p s·ªë/serial sim" />
      </div>
      <div class="col-md-4 mb-2">
            <ng-select
              class="custom-ng-select w-100"
              [items]="listSellChannel"
              bindLabel="name"
              bindValue="id"
              [(ngModel)]="searchForm.channelId"
              name="channelName"
              placeholder="Ch·ªçn kho"
              [searchable]="true"
              [clearable]="false"
              [dropdownPosition]="'auto'"
             >
            <ng-template ng-header-tmp>
              <div style="padding: 8px; color: #6c757d; font-size: 0.875rem;">
                üîç G√µ ƒë·ªÉ t√¨m ki·∫øm kho...
              </div>
            </ng-template>
            </ng-select>
      </div>
      <div class="col-md-4 mb-2">
        <input class="form-control" [(ngModel)]="searchForm.assignedUser" name="assignedUser" placeholder="T√™n ng∆∞·ªùi ƒë∆∞·ª£c giao" />
      </div>

      <div class="col-md-4 mb-2">
        <input
          type="text"
          placeholder="Kho·∫£ng th·ªùi gian"
          [ngModelOptions]="{ standalone: true }"
          ngxDaterangepickerMd
          [(ngModel)]="dateRange"
          [ranges]="ranges"
          [locale]="{ applyLabel: 'Ch·ªçn', format: 'DD/MM/YYYY' }"
          [showCustomRangeLabel]="true"
          [alwaysShowCalendars]="true"
          name="date_range"
          class="form-control"
        />
      </div>
      
      <div class="col-md-12 d-flex mt-1">
        <button type="submit" class="btn btn-info mr-1">
          <i data-feather="search" class="mr-50"></i> L·ªçc k·∫øt qu·∫£
        </button>
        <button type="button" class="btn btn-success" (click)="exportExcel()">
          <i data-feather="file" class="mr-50"></i> Xu·∫•t excel
        </button>
      </div>
    </form>
  </div>

  <div class="table-responsive mt-2">
    <div class="col-md-12 mb-1">
      <span>T·ªïng s·ªë: </span> <b>{{ totalItems }}</b>
    </div>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>STT</th>
          <th>Kho</th>
          <th>S·ªë ƒëi·ªán tho·∫°i</th>
          <th>Serial SIM</th>
          <th>Th·ªùi gian giao</th>
          <th>Ng∆∞·ªùi ƒë∆∞·ª£c giao</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of list; index as i">
          <td>{{ (searchForm.page - 1) * searchForm.take + (i + 1) }}</td>
          <td>{{ item.channel_name }}</td>
          <td>{{ item.name }}</td>
          <td>{{ item.serial }}</td>
          <td>{{ item.updated_at | date: 'dd/MM/yyyy HH:mm' }}</td>
          <td>{{ item.full_name }}</td>
          <td>
            <div class="row mt-1">
              <div class="col-md-2">
                <button class="tooltip-wrapper btn p-0 border-0 bg-transparent" (click)="openUpdateSimModal(modalUpdateSim, item)" >
                  <i data-feather="edit" class="text-primary cursor-pointer"></i>
                  <span class="custom-tooltip">C·∫≠p nh·∫≠t ng∆∞·ªùi nh·∫≠n SIM</span>
                </button>
            </div>
            <div class="col-md-2">
                <button class="tooltip-wrapper btn p-0 border-0 bg-transparent" (click)="openViewSimModal(viewSimModal, item)" >
                  <i data-feather="eye" class="text-primary cursor-pointer"></i>
                  <span class="custom-tooltip">Xem chi ti·∫øt ng∆∞·ªùi nh·∫≠n SIM</span>
                </button>
            </div>
          </div>
          </td>
        </tr>
        <tr *ngIf="list.length === 0">
          <td colspan="7" class="text-center text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
        </tr>
      </tbody>
    </table>

<ng-template #modalUpdateSim let-modal>
  <div class="modal-header text-center d-block">
    <h3 class="modal-title font-weight-bold text-center w-100 mb-0">
      C·∫≠p nh·∫≠t ng∆∞·ªùi s·ª≠ d·ª•ng SIM
    </h3>
        <p class="text-muted mt-1">[{{ selectedSim?.name }}]</p>
    <button type="button" class="close position-absolute btn btn-danger" style="top: 10px; right: 25px" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <form (ngSubmit)="onSubmitUpdateSim()" #formUpdate="ngForm">
    <div class="modal-body">
      <div class="form-row row">
        <div class="form-group col-md-6">
          <label>M√£ CBNV <span class="text-danger">*</span></label>
          <input class="form-control" name="code" [(ngModel)]="updateSimForm.code" required />
        </div>
        <div class="form-group col-md-6">
          <label>H·ªç t√™n CBNV <span class="text-danger">*</span></label>
          <input class="form-control" name="name" [(ngModel)]="updateSimForm.name" required />
        </div>
      </div>

      <div class="form-row row">
        <div class="form-group col-md-6">
          <label>S·ªë ƒëi·ªán tho·∫°i li·ªán h·ªá <span class="text-danger">*</span></label>
          <input class="form-control" name="phone" [(ngModel)]="updateSimForm.phone"  required />
        </div>
        <div class="form-group col-md-6">
          <label>Email <span class="text-danger">*</span></label>
          <input class="form-control" name="email" [(ngModel)]="updateSimForm.email" required />
        </div>
      </div>
      <div class="form-row row">
        <div class="form-group col-md-6">
          <label>ƒê∆°n v·ªã <span class="text-danger">*</span></label>
            <ng-select
              class="custom-ng-select w-100"
              [items]="listUnit"
              bindLabel="name"
              bindValue="id"
              [(ngModel)]="updateSimForm.unit_id"
              name="unit_id"
              placeholder="Ch·ªçn ƒë∆°n v·ªã"
              [searchable]="false"
              [clearable]="false"
              [dropdownPosition]="'auto'"
              [ngModelOptions]="{ standalone: true }">
            </ng-select>
        </div>
        <div class="form-group col-md-6">
          <label>Ghi ch√∫</label>
          <input class="form-control" name="note" [(ngModel)]="updateSimForm.note" />
        </div>
      </div>
    </div>
    <div class="modal-footer text-center d-block justify-content-between">
      <button type="submit" class="btn btn-success">C·∫≠p nh·∫≠t</button>
      <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">H·ªßy</button>
    </div>
  </form>
</ng-template>

    <ng-template #viewSimModal let-modal>

    <div class="modal-header text-center d-block">
    <h3 class="modal-title font-weight-bold text-center w-100 mb-0">
      Xem chi ti·∫øt ng∆∞·ªùi s·ª≠ d·ª•ng SIM
    </h3>
        <p class="text-muted mt-1">[{{ selectedSim?.name }}]</p>
    <button type="button" class="close position-absolute btn btn-danger" style="top: 10px; right: 25px" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body" *ngIf="selectedSim">
    <div class="form-row row">
      <div class="form-group col-md-6">
        <label>M√£ CBNV:</label>
        <input class="form-control" [value]="selectedSim.user_code" readonly />
      </div>
      <div class="form-group col-md-6">
        <label>H·ªç t√™n CBNV:</label>
        <input class="form-control" [value]="selectedSim.full_name" readonly />
      </div>
    </div>

    <div class="form-row row">
      <div class="form-group col-md-6">
        <label>S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá:</label>
        <input class="form-control" [value]="selectedSim.mobile" readonly />
      </div>
      <div class="form-group col-md-6">
        <label>Email:</label>
        <input class="form-control" [value]="selectedSim.email" readonly />
      </div>
    </div>

    <div class="form-row row">
      <div class="form-group col-md-6">
        <label>ƒê∆°n v·ªã:</label>
    <input class="form-control" [value]="getUnitName(selectedSim.unit_id)" readonly />
      </div>
      <div class="form-group col-md-6">
        <label>Ghi ch√∫:</label>
        <input class="form-control" [value]="selectedSim.note" readonly />
      </div>
    </div>
  </div>

    <div class="modal-footer text-center d-block justify-content-between">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">ƒê√≥ng</button>
  </div>
</ng-template>

<ng-template #confirmUpdateModal let-modal>
  <div class="modal-header text-center d-block">
    <h3 class="modal-title font-weight-bold text-center w-100 mb-0">
      X√°c nh·∫≠n c·∫≠p nh·∫≠t ng∆∞·ªùi s·ª≠ d·ª•ng SIM
    </h3>         <p class="text-muted mt-1">[{{ selectedSim?.name }}]</p>

    <button type="button" class="close position-absolute btn btn-danger" style="top: 10px; right: 25px" aria-label="Close" (click)="modal.dismiss()">
      &times;
    </button>
  </div>
  <div class="modal-body text-center">
    B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën c·∫≠p nh·∫≠t <strong>{{ updateSimForm.name }}</strong> l√† ng∆∞·ªùi s·ª≠ d·ª•ng SIM <strong>{{ selectedSim?.name }}</strong>?
  </div>
  
    <div class="modal-footer text-center d-block justify-content-between">
    <button type="button" class="btn btn-success" (click)="confirmUpdate(modal)">ƒê·ªìng √Ω</button>
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">H·ªßy</button>
  </div>
</ng-template>

<ngb-pagination
  class="d-flex justify-content-end pr-3 pt-2"
  [collectionSize]="totalPage"
  [(page)]="searchForm.page"
  [pageSize]="searchForm.take"
  [boundaryLinks]="true"
  (pageChange)="loadPage($event)"
>
  <ng-template ngbPaginationPages let-page let-pages="pages">
    <li class="ngb-custom-pages-item" *ngIf="pages.length > 0">
      <div class="mb-3 d-flex flex-nowrap px-2">
        <label for="paginationInput" class="col-form-label me-2 ms-1">Trang</label>
        <input
          #i
          type="text"
          inputmode="numeric"
          pattern="[0-9]*"
          class="form-control custom-pages-input"
          id="paginationInput"
          [value]="searchForm.page"
          (keyup.enter)="loadPage(i.value)"
          (blur)="loadPage(i.value)"
          (input)="formatInput($any($event).target)"
          style="width: 2.7rem"
        />
        <span class="col-form-label text-nowrap px-2">
          c·ªßa {{ pages.length }}
        </span>
      </div>
    </li>
  </ng-template>
</ngb-pagination>

  </div>
</div>
